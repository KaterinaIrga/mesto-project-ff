(()=>{"use strict";var e={629:(e,t,o)=>{e.exports=o.p+"images/edit-icon.6c7bf05444b9793fdf6e.svg"}},t={};function o(n){var r=t[n];if(void 0!==r)return r.exports;var c=t[n]={exports:{}};return e[n](c,c.exports,o),c.exports}o.m=e,o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.p="",o.b=document.baseURI||self.location.href,(()=>{var e=function(){return fetch("https://nomoreparties.co/v1/pwff-cohort-1/users/me",{method:"GET",headers:{authorization:"95e6fe45-0fdc-4b40-8bb6-4db715dbdfac"}}).then((function(e){return e.json()})).then((function(e){return e})).catch((function(e){console.log("Ошибка. Запрос не выполнен getUserInfo.")}))};function t(t,o,n,r,c){var i=r.querySelector(".card").cloneNode(!0),a=i.querySelector(".card__delete-button"),u=i.querySelector(".card__like-button"),s=(i.querySelector(".card__like-counter"),new URL(t.link,"file:///C:/Dev/mesto-project-ff/src/components/card.js"));return e().then((function(e){var n=e._id;return n===t.owner._id&&(a.classList.add("card__delete-button_active"),a.addEventListener("click",(function(e){e.stopPropagation(),e.target.classList.contains("card__delete-button")&&o(a)}))),n})).then((function(e){var o,n;o=t.likes,n=e,Array.from(o).some((function(e){return e._id===n}))&&u.classList.add("card__like-button_is-active")})).catch((function(e){return console.log("Произошла ошибка при получении idUser для карточки")})),i.querySelector(".card__image").src=s,i.querySelector(".card__image").alt=t.name,i.querySelector(".card__title").textContent=t.name,i.addEventListener("click",c),i.setAttribute("id",t._id),u.addEventListener("click",(function(){return n(u)})),i}function n(e){var t,o=e.closest(".card");t=o.getAttribute("id"),console.log(t),fetch("https://nomoreparties.co/v1/pwff-cohort-1/cards/".concat(t," "),{method:"DELETE",headers:{authorization:"95e6fe45-0fdc-4b40-8bb6-4db715dbdfac"}}).then((function(e){e.json()})).then((function(e){return e})).catch((function(e){console.log(e)})),o.remove()}function r(e){var t=e.closest(".card").querySelector(".card__like-counter"),o=e.closest(".card").getAttribute("id");e.classList.toggle("card__like-button_is-active"),function(e,t){var o=t?"PUT":"DELETE";return fetch("https://nomoreparties.co/v1/pwff-cohort-1/cards/likes/".concat(e),{method:o,headers:{authorization:"95e6fe45-0fdc-4b40-8bb6-4db715dbdfac"}}).then((function(e){return e.json()})).then((function(e){return e}))}(o,e.classList.contains("card__like-button_is-active")).then((function(e){t.textContent=e.likes.length})).catch((function(e){console.log("Что-то пошло не так при лайке."),console.log(e)})).finally((function(){return t.textContent}))}function c(e){return e.classList.toggle("popup_is-opened",!0),e.classList.toggle("popup_is-animated",!0),e.addEventListener("click",u),document.addEventListener("keydown",a),e}function i(e){e.classList.remove("popup_is-animated"),e.classList.remove("popup_is-opened"),e.removeEventListener("click",u),document.removeEventListener("keydown",a)}function a(e){"Escape"===e.key&&(i(document.querySelector(".popup_is-opened")),e.preventDefault())}function u(e){("submit"===e.type||e.target.classList.contains("popup")||e.target.classList.contains("popup__close"))&&i(e.currentTarget),e.stopPropagation()}var s="data-empty-error",l="data-content-error",p="data-type-error",d={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:".popup__button_inactive",inputErrorClass:".popup__input-border-error",errorClass:".popup__input-error"};function f(e){var t,o=e.querySelector(d.submitButtonSelector);t=e,Array.from(t.elements).some((function(e){return!e.validity.valid}))?(o.disabled=!0,o.classList.add(d.inactiveButtonClass.slice(1))):(o.disabled=!1,o.classList.remove(d.inactiveButtonClass.slice(1)))}function _(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d;Array.from(e.querySelectorAll(t.errorClass)).forEach((function(e){y(0,e),e.textContent="",d.inputErrorClass})),Array.from(e.querySelectorAll(t.inputErrorClass)).forEach((function(e){e.classList.remove(t.inputErrorClass.slice(1))})),f(e)}function m(e,t){t.validity.valid?y(0,t):function(e,t){var o=document.getElementById("popup__input-".concat(t.getAttribute("name"),"-error"));if(""===t.value){var n=s;o.textContent=t.getAttribute(n),o.classList.add(d.inputErrorClass.slice(1)),t.classList.add(d.errorClass.slice(1))}else if(t.validity.typeMismatch){var r=p;o.textContent=t.getAttribute(r),o.classList.add(d.inputErrorClass.slice(1)),t.classList.add(d.errorClass.slice(1))}else if(t.validity.patternMismatch){var c=l;o.textContent=t.getAttribute(c),o.classList.add(d.inputErrorClass.slice(1)),t.classList.add(d.errorClass.slice(1))}else(t.validity.tooLong||t.validity.tooShort)&&(o.textContent=t.getAttribute("data-long-short-error"),o.classList.add(d.inputErrorClass.slice(1)),t.classList.add(d.errorClass.slice(1)))}(0,t)}function y(e,t){var o=document.getElementById("popup__input-".concat(t.getAttribute("name"),"-error"));o&&(o.textContent="",o.classList.remove(d.inputErrorClass.slice(1))),t.classList.remove(d.errorClass.slice(1))}const v=o.p+"images/logo.0863e5bc26221680f1e2.svg";var h=document.querySelector(".page"),b=h.querySelector(".profile"),g=document.querySelector(".places__list"),S=document.querySelector("#card-template").content;Array.from(document.forms).forEach((function(e){var t;t=e,Array.from(t.querySelectorAll(d.inputSelector)).forEach((function(e){e.addEventListener("blur",(function(o){m(0,e),f(t)})),e.addEventListener("change",(function(){m(0,e),f(t)})),e.addEventListener("input",(function(){m(0,e),f(t)}))}))})),function(e,t){t.then((function(t){e.querySelector(".profile__title").textContent=t.name,e.querySelector(".profile__description").textContent=t.about,e.querySelector(".profile__image").style="background-image: url('".concat(t.avatar,"')"),e.querySelector(".profile__image-edit").addEventListener("mouseover",(function(){E()})),e.querySelector(".profile__image-edit").addEventListener("mouseout",(function(){k()})),console.log("Профиль успешно создан.")})).catch((function(){console.log("При осоздании профиля что-то пошло не так...")})).finally((function(){return console.log("createProfile.finally")}))}(b,e()),fetch("https://nomoreparties.co/v1/pwff-cohort-1/cards ",{method:"GET",headers:{authorization:"95e6fe45-0fdc-4b40-8bb6-4db715dbdfac"}}).then((function(e){return e.json()})).then((function(e){return e})).catch((function(e){console.log("Ошибка. Запрос не выполнен getCardsData.")})).then((function(e){e.forEach((function(e){g.append(t(e,n,r,S,A))}))}));var q=h.querySelector(".profile__edit-button"),C=h.querySelector(".profile__add-button"),L=h.querySelector(".profile__image-edit");function E(){var e=new URL(o(629),o.b);b.querySelector(".profile__image-edit").style="background-image : url('".concat(e,"'), linear-gradient(rgba(0,0,0, 0.5), rgba(0,0,0, 0.5))"),console.log(b.querySelector(".profile__image-edit").style)}function k(){b.querySelector(".profile__image-edit").style="background-image: none;"}function x(e,t){t.then((function(t){e.querySelector(".profile__title").textContent=t.name,e.querySelector(".profile__description").textContent=t.about,e.querySelector(".profile__image").style="background-image: url('".concat(t.avatar,"')"),console.log("Профиль успешно обновлен."),console.log(t)})).catch((function(){console.log("При обновлении профиля что-то пошло не так...")})).finally((function(){return console.log("updateProfile.finally")}))}function A(e){var t=document.querySelector(".card"),o=t.querySelector(".card__like-button");if(e.currentTarget===t&&e.target!==o){var n=c(document.querySelector(".popup_type_image"));n.querySelector(".popup__image").src=t.querySelector(".card__image").getAttribute("src"),n.querySelector(".popup__caption").textContent=t.querySelector(".card__title").textContent,e.stopPropagation()}}function w(e,t){e.textContent=t}function j(o){var c=o.target,i=c.querySelector(".popup__button");w(i,"Сохранение..."),new Promise((function(i,a){switch(c.getAttribute("name")){case"edit-avatar":(p=c.elements.avatar.value,fetch("https://nomoreparties.co/v1/pwff-cohort-1/users/me/avatar",{method:"PATCH",headers:{authorization:"95e6fe45-0fdc-4b40-8bb6-4db715dbdfac","Content-Type":"application/json"},body:JSON.stringify({avatar:p})}).then((function(e){e.json()})).then((function(e){return e})).catch((function(e){console.log("Ого! Что-то пошло не так: ".concat(e,"..."))}))).then((function(){x(b,e())})).catch((function(e){console.log(e)})),i("Сохранить"),a(new Error("Где-то произошла ошибка..."));break;case"edit-profile":(s=c.elements.name.value,l=c.elements.description.value,fetch("https://nomoreparties.co/v1/pwff-cohort-1/users/me ",{method:"PATCH",headers:{authorization:"95e6fe45-0fdc-4b40-8bb6-4db715dbdfac","Content-Type":"application/json"},body:JSON.stringify({name:s,about:l})}).then((function(e){return e.json()})).then((function(e){return e})).catch((function(e){console.log(e)}))).then((function(){x(b,e())})),i("Сохранить"),a(new Error("Где-то произошла ошибка..."));break;case"new-place":(u={name:c.elements["place-name"].value,link:c.elements.link.value},fetch("https://nomoreparties.co/v1/pwff-cohort-1/cards ",{method:"POST",headers:{authorization:"95e6fe45-0fdc-4b40-8bb6-4db715dbdfac","Content-Type":"application/json"},body:JSON.stringify({name:u.name,link:u.link})}).then((function(e){return e.json()})).then((function(e){return e}))).then((function(e){g.prepend(t(e,n,r,S,A))})),i("Сохранить"),a(new Error("Где-то произошла ошибка..."));break;default:o.stopPropagation()}var u,s,l,p})).then((function(e){w(i,e)})).catch((function(e){w(i,e.message)}))}document.querySelector(".card__image"),document.querySelector(".header__logo").src=v,q.addEventListener("click",(function(){var e=c(document.querySelector(".popup_type_edit")),t=e.querySelector(".popup__input_type_name"),o=e.querySelector(".popup__input_type_description"),n=e.querySelector(".popup__form");_(n),t.textContent="",o.textContent="",o.placeholder=document.querySelector(".profile__description").textContent,t.placeholder=document.querySelector(".profile__title").textContent,n.addEventListener("submit",(function(t){j(t),i(e)}))})),C.addEventListener("click",(function(){var e=c(document.querySelector(".popup_type_new-card")),t=e.querySelector(".popup__input_type_card-name"),o=e.querySelector(".popup__input_type_url");t.textContent="",o.textContent="",_(e.querySelector(".popup__form")),e.querySelector(".popup__form").addEventListener("submit",(function(t){j(t),i(e)}))})),L.addEventListener("click",(function(){var e=c(document.querySelector(".popup_type_avatar")),t=(e.querySelector(".popup__input_type_avatar"),e.querySelector(".popup__form"));_(t),t.addEventListener("submit",(function(t){j(t),i(e)}))}))})()})();